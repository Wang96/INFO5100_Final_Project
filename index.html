<html>

<head>
  <title>Project</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
      p{
          font-family: "Montserrat", sans-serif;
          font-size: 0.8333vw;
          margin: 1vw;
          line-height: 2;
        }
      .SelectAge{
        font-size: 1vw;
        margin: 0 0 0 0; 
      }
      p#title {
          margin-top: 2.083vw;
          margin-bottom: 0vw;
          font-weight: 800;
          font-size: 2.5vw;
          text-align: center;
          color: rgb(255, 255, 255);
        }
      p#subtitle {
          margin-top: 0vw;
          margin-bottom: 0vw;
          font-weight: 400;
          font-size: 1.5vw;
          text-align: center;
          color: rgb(255, 255, 255);
        }
      div {
          display: block; 
          font-size: 1vw;
          margin-top: 2vw;
          margin-bottom: 2vw;
        }
      div#RadiusChart {
          display: inline-block;
          height:120%;
          width:90%;
          text-align: center;
          color:rgb(255, 255, 255);
          background-color:#1D1D2F;
          margin-left:5%;
          margin-right:5%;
          border-radius:2%;
          box-shadow: 0.5vw 0.5vw 2vw #0D0B15;
        }
      div#Line {
          display: inline-block;
          height:60%;
          width:90%;
          text-align: center;
          color:rgb(255, 255, 255);
          background-color:#1D1D2F;
          margin-left:5%;
          margin-right:5%;
          border-radius:2%;
          box-shadow: 0.5vw 0.5vw 2vw #0D0B15;
        }
      div#Selectors {
            display: inline-block;
            width: 15%;
            vertical-align: top;
            align-items: left;
      }
      div#Diagram {
            display: inline-block;
            width: 75%;
            height:100%;
            vertical-align: top;
      }
      svg {
          font-family: "Montserrat", sans-serif;
          font-size: 0.694vw;
          margin: auto;
        }
      body {
          font-family: "Montserrat", sans-serif;
          font-size: 0.694vw;
          background-color:#151521;
          margin: auto;
        }
      #majorlabel {
          font-family: "Montserrat", sans-serif;
          font-size: 12px;
          margin-right: 10px;
        }
  /* LineChart Style*/
      .x path {
          stroke: rgb(109, 167, 233);
          opacity: 0.75;
        }
      .x line {
          stroke: rgb(109, 167, 233);
          opacity: 0.75;
        }
      .x text {
          font-family: "Montserrat", sans-serif;
          font-size: 1.5vw;
          color: rgb(109, 167, 233);
          opacity: 0.75;
        }
      .y path {
          stroke: rgb(109, 167, 233);
          opacity: 0.75;
        }
      .y line {
          stroke: rgb(109, 167, 233);
          opacity: 0.75;
        }
      .y text {
          font-family: "Montserrat", sans-serif;
          font-size: 1.5vw;
          color: rgb(109, 167, 233);
          opacity: 0.75;
        }
  /* PieChare Style*/
      #legendforChart {
          position: absolute;
          left: 10%
        }
      #legend {
          position: absolute;
          left: 10%
        }
  /* Source for tool tip: http://bl.ocks.org/d3noob/a22c42db65eb00d4e369 */
      div.tooltip {
          text-align: center;
          vertical-align: middle;
          width: 100%;
          height: 8%;
          padding: 1%;
          padding-top:5%;
          font-size: 1vw;
          font-family: "Montserrat", sans-serif;
          background: rgb(109, 167, 233);
          border: 0px;
          border-radius: 8px;
          pointer-events: none;
        }
  /* DropDown */
  /* Reference: https://www.w3schools.com/howto/howto_custom_select.asp */
      .SelectText{
          justify-content: flex-start;
          text-align: left;
          margin-left:2%;
          margin-top:4%;
          margin-bottom:0%;
          display: block;
          position: relative;
      }
      div.custom-select {
          justify-content: flex-start;
          margin-left: 2%;
          margin-top:0;
          display: block;
          position: relative;
          font-family: "Montserrat", sans-serif;
          border-bottom: 0.139vw solid #FFFFFF;
        }

      .custom-select select {
          display: none; /*hide original SELECT element: */
        }

      .select-selected {
          border-bottom: 0.139vw solid #FFFFFF;
        }

  /* Style the arrow inside the select element: */
      .select-selected:after {
          display: block;
          position: absolute;
          content: "";
          top: 0.972vw;
          right: 0.694vw;
          width: 0;
          height: 0;
          border: 0.417vw solid transparent;
          border-color: #fff transparent transparent transparent;
        }

  /* Point the arrow upwards when the select box is open (active): */
      .select-selected.select-arrow-active:after {
          display: block;
          border-color: transparent transparent #fff transparent;
          top: 0.486vw;
          margin-top: 0vw;
          margin-bottom: 0vw;
        }

  /* style the items (options), including the selected item: */
      .select-items div,.select-selected {
          display: block;
          color: #ffffff;
          padding: 0.556vw 1.11vw;
          border: 0.07vw solid transparent;
          border-color: transparent transparent rgba(0, 0, 0, 0.1) transparent;
          cursor: pointer;
          margin-top: 0vw;
          margin-bottom: 0vw;
        }

  /* Style items (options): */
      .select-items {
          display: block;
          position: absolute;
          background-color: #24293F;
          top: 100%;
          left: 0;
          right: 0;
          z-index: 99;
          margin-top: 0vw;
          margin-bottom: 0vw;
        }

  /* Hide the items when the select box is closed: */
      .select-hide {
          display: none;
        }

      .select-items div:hover, .same-as-selected {
          display: block;
          background-color: rgba(117, 147, 208, 0.1);
          border-bottom: 0.139vw solid #FFFFFF;
        } 
  </style>
</head>

<body>
  <p id = "title">Predict your Life</p>
  <p id = "subtitle">See how people like you live</p>
<div id ="RadiusChart">
  <div id = "Selectors">
        <div class = "SelectText" style="width:100%;">
            <p class = "SelectAge"> Select the Age: </p>
        </div>
        <div class="custom-select" style="width:100%;" >
            <select id="age">
                  <option value="">15</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                  <option value="24">24</option>
                  <option value="25">25</option>
                  <option value="26">26</option>
                  <option value="27">27</option>
                  <option value="28">28</option>
                  <option value="29">29</option>
                  <option value="30">30</option>
            </select>
        </div>
        <div class = "SelectText" style="width:100%;">
            <p class = "SelectAge"> Select the Gender: </p>
        </div>
        <div class="custom-select" style="width:100%;" >
            <select id="gender">
                  <option value="">Female</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
              </select>  
        </div>
        <div class = "SelectText" style="width:100%;">
            <p class = "SelectAge"> Radius Chart Legends: </br>/*Radius Chart is clickable*/</p>
        </div>
        <svg id="legendforChart" height=80% width=15%>
          </svg>
        <svg id="legend" height=80% width=15%>
        </svg>
  </div>
  <div id = "Diagram">
        <svg id="Chart" width = 100% > 
        </svg>
  </div>      
</div>
<div id="line">
  <div id = "Selectors">
      <div class = "SelectText" style="width:100%;">
          <p class = "SelectAge"> Select Your Undergraduate Major: </p>
      </div>
      <div class="custom-select" style="width:100%;" >
          <select id="major">
            <option value="Accounting">Accounting</option>
            <option value="Accounting">Accounting</option>
            <option value="Aerospace-Engineering">Aerospace-Engineering</option>
            <option value="Agriculture">Agriculture</option>
            <option value="Anthropology">Anthropology</option>
            <option value="Architecture">Architecture</option>
            <option value="Art-History">Art-History</option>
            <option value="Biology">Biology</option>
            <option value="Business-Management">Business-Management</option>
            <option value="Chemical-Engineering">Chemical-Engineering</option>
            <option value="Chemistry">Chemistry</option>
            <option value="Civil-Engineering">Civil-Engineering</option>
            <option value="Communications">Communications</option>
            <option value="Computer-Engineering">Computer-Engineering</option>
            <option value="Computer-Science">Computer-Science</option>
            <option value="Construction">Construction</option>
            <option value="Criminal-Justice">Criminal-Justice</option>
            <option value="Drama">Drama</option>
            <option value="Economics">Economics</option>
            <option value="Education">Education</option>
            <option value="Electrical-Engineering">Electrical-Engineering</option>
            <option value="English">English</option>
            <option value="Film">Film</option>
            <option value="Finance">Finance</option>
            <option value="Forestry">Forestry</option>
            <option value="Geography">Geography</option>
            <option value="Geology">Geology</option>
            <option value="Graphic-Design">Graphic-Design</option>
            <option value="Health-Care-Administration">Health-Care-Administration</option>
            <option value="History">History</option>
            <option value="Hospitality-Tourism">Hospitality-Tourism</option>
            <option value="Industrial-Engineering">Industrial-Engineering</option>
            <option value="Information-Technology">Information-Technology</option>
            <option value="Interior-Design">Interior-Design</option>
            <option value="International-Relations">International-Relations</option>
            <option value="Journalism">Journalism</option>
            <option value="Management-Information-Systems">Management-Information-Systems</option>
            <option value="Marketing">Marketing</option>
            <option value="Math">Math</option>
            <option value="Mechanical-Engineering">Mechanical-Engineering</option>
            <option value="Music">Music</option>
            <option value="Nursing">Nursing</option>
            <option value="Nutrition">Nutrition</option>
            <option value="Philosophy">Philosophy</option>
            <option value="Physician-Assistant">Physician-Assistant</option>
            <option value="Physics">Physics</option>
            <option value="Political-Science">Political-Science</option>
            <option value="Psychology">Psychology</option>
            <option value="Religion">Religion</option>
            <option value="Sociology">Sociology</option>
            <option value="Spanish">Spanish</option>
          </select>
      </div>
      <div class = "tool" style="width:100%;">
      </div>
    </div>

      <div id = "Diagram">
            <svg id="linechart" width = 100%> 
            </svg>
      </div>
</div> 
  <script>


    /************************ Pie Charts ************************************/
    /* Request Data */
    const requestData = async () => {
      // Drawing basic us map
      const pie_data = await d3.json("./dataset/pie.json");

      var type = "romantic"
      var major = 'Computer Science';
      var age = '18';
      var gender = 'female';

      // Create pie chart 
      var color = d3.scaleOrdinal(d3.schemePastel1);
      var catmapping = { '1': "one", '2': "two", '3': "three", '4': "four", '5': "five" };

      function createPieChart(data, type) {
        var tmp = {}
        /* Remove Previous Pie Chart */
        d3.select('#Chart').selectAll('g.pie').remove();
        d3.select("#legend").selectAll("rect").remove();
        d3.select("#legend").selectAll("text").remove();

        var Title = ""
        var svg = d3.select("#Chart");
        var width = document.getElementById("Chart").clientWidth;
        var height = document.getElementById("Chart").clientHeight;
        console.log(document.getElementById("Chart").clientHeight);
        var radius = Math.min(width, height) / 20;
        var pie = {};
            pie = d3.pie().value(function (d) { return d.value })(data);
        /* Different categories have different questions */
        /* Define questions for every category*/
        if(type=='healthy lifestyle')
          {
            Title = "I live a very healthy lifestyle";
            for(let key in pie)
            {
              if (pie[key].data.category=="5")
                  pie[key].data.category = "5. Strongly agree"
              else if (pie[key].data.category=="4")
                  pie[key].data.category = "4. Agree"
              else if (pie[key].data.category=="3")
                  pie[key].data.category = "3. Neither"
              else if (pie[key].data.category=="2")
                  pie[key].data.category = "2. Disagree"
              else if (pie[key].data.category=="1")
                  pie[key].data.category = "1. Strongly disagree"
            }
          }
        else if(type=='public speaking'||type=='dangerous dogs'||type=='ageing'||type=='rats/mice'||type=='snakes'||type=='spiders'||type=='heights'||type=='darkness'||type=='thunder/lightning'||type=='fliying')
          {
            Title = "I'm afraid of "+type;
            for(let key in pie)
            {
              if (pie[key].data.category=="5")
                  pie[key].data.category = "5. Very afraid of"
              else if (pie[key].data.category=="4")
                  pie[key].data.category = "4. Afraid of"
              else if (pie[key].data.category=="3")
                  pie[key].data.category = "3. Not very afraid of"
              else if (pie[key].data.category=="2")
                  pie[key].data.category = "2. A little bit afraid of"
              else if (pie[key].data.category=="1")
                  pie[key].data.category = "1. Not afraid at all"
            }
          }
        else if(type=='cars'||type=='poerty writing'||type=='social'||type=='pets'||type=='shopping'||type=='gardening'||type=='sport'||type=='instrument'||type=='dancing'||type=='outdoor')
          {
            Title = "I'm interested in "+type;
            for(let key in pie)
            {
              if (pie[key].data.category=="5")
                  pie[key].data.category = "5. Very interested in"
              else if (pie[key].data.category=="4")
                  pie[key].data.category = "4. Interested in"
              else if (pie[key].data.category=="3")
                  pie[key].data.category = "3. Not very interested in"
              else if (pie[key].data.category=="2")
                  pie[key].data.category = "2. A little bit interested in "
              else if (pie[key].data.category=="1")
                  pie[key].data.category = "1. Not interested in"
            }
          }
        else if(type=='cars'||type=='poerty writing'||type=='social'||type=='pets'||type=='shopping'||type=='gardening'||type=='sport'||type=='instrument'||type=='dancing'||type=='outdoor')
          {
            Title = "I'm interested in "+type;
            for(let key in pie)
            {
              if (pie[key].data.category=="5")
                  pie[key].data.category = "5. Very interested in"
              else if (pie[key].data.category=="4")
                  pie[key].data.category = "4. Interested in"
              else if (pie[key].data.category=="3")
                  pie[key].data.category = "3. Not very interested in"
              else if (pie[key].data.category=="2")
                  pie[key].data.category = "2. A little bit interested in "
              else if (pie[key].data.category=="1")
                  pie[key].data.category = "1. Not interested in"
            }
          }
        else if(type=='action'||type=='document'||type=='cartoon'||type=='tale'||type=='war'||type=='scifi'||type=='romantic'||type=='comedy'||type=='thriller'||type=='horror')
          {
            Title = "I really enjoy watching "+type+" movies";
            for(let key in pie)
            {
              if (pie[key].data.category=="5")
                  pie[key].data.category = "5. Strongly agree"
              else if (pie[key].data.category=="4")
                  pie[key].data.category = "4. Agree"
              else if (pie[key].data.category=="3")
                  pie[key].data.category = "3. Neither"
              else if (pie[key].data.category=="2")
                  pie[key].data.category = "2. Disagree"
              else if (pie[key].data.category=="1")
                  pie[key].data.category = "1. Strongly disagree"
            }
          }
          else if(type=='punk'||type=='jazz'||type=='musical'||type=='hippop'||type=='opera'||type=='rock'||type=='pop'||type=='classical'||type=='country'||type=='dance')
          {
            Title = "I really enjoy listening to "+type+" musics";
            for(let key in pie)
            {
              if (pie[key].data.category=="5")
                  pie[key].data.category = "5. Strongly agree"
              else if (pie[key].data.category=="4")
                  pie[key].data.category = "4. Agree"
              else if (pie[key].data.category=="3")
                  pie[key].data.category = "3. Neither"
              else if (pie[key].data.category=="2")
                  pie[key].data.category = "2. Disagree"
              else if (pie[key].data.category=="1")
                  pie[key].data.category = "1. Strongly disagree"
            }
          }
          else if(type=='healthy food'||type=='gadgets'||type=='appearance'||type=='entertainment'||type=='branded cloth'||type=='large shopping center'||type=='save money')
          {
            Title = "I spend a lot of money on "+type;
            for(let key in pie)
            {
              if (pie[key].data.category=="5")
                  pie[key].data.category = "5. Strongly agree"
              else if (pie[key].data.category=="4")
                  pie[key].data.category = "4. Agree"
              else if (pie[key].data.category=="3")
                  pie[key].data.category = "3. Neither"
              else if (pie[key].data.category=="2")
                  pie[key].data.category = "2. Disagree"
              else if (pie[key].data.category=="1")
                  pie[key].data.category = "1. Strongly disagree"
            }
          }
         /* Give value to tmp*/
        data.forEach(d => {
          tmp[d.category] = d.value;
        })
        var arc = d3.arc().outerRadius(radius - 10).innerRadius(100);
        var labelArc = d3.arc().outerRadius(radius - 40).innerRadius(radius - 40);
        var chart = svg.append("g").attr("class","pie").attr("transform", "translate(" + 0 + "," + 0 + ")");
        var g = chart.selectAll("arc").data(pie).enter().append("g").attr("class", "arc").attr("note", d => d.data.category);
        
        g.append("path").attr("d", arc).style("fill", function (d) { return color(d.data.category); }); 
        g.append("text").text(Title).style("text-anchor", "middle").style("fill", "#FFF").style("font-size", "1.5vw").attr("transform", "translate(" + 0 + "," + (radius-180) + ")");
        /* Mouseover Event */
        d3.select("#Chart").selectAll("g").selectAll(".arc")
          .on("mouseover", function () {
            let category = d3.select(this).attr("note");
            let id=category.replace(/[ 12345.]/g,"")
            d3.select("#Chart").append("text")
              .attr("id", id)
              .attr("x", 0)
              .attr("y", radius+100)
              .text(category)
              .attr("text-anchor","middle")
              .style("font-size", "1.2vw")
              .style("fill", "#FFF");

            d3.select("#Chart").append("text")
              .attr("id", "category_value")
              .attr("x", 0)
              .attr("y", radius+130)
              .text((tmp[category] * 100).toFixed(2) + '%')
              .style("font-size", "1.2vw")
              .attr("text-anchor","middle")
              .style("fill", "#FFF");

            d3.select(this).style("opacity", 0.5);
          })
          .on("mouseout", function () {
            let category = d3.select(this).attr("note");
            category=category.replace(/[ 12345.]/g,"")
            d3.select(this).style("opacity", 1);
            d3.select("#" + category).remove();
            d3.select("#category_value").remove();
          });

        var legend = d3.select("#legend")
        legend.append("text")
            .attr("x", 0)
            .attr("y", 7 * 30 + 50)
            .attr("height", 25)
            .text("Pie Chart Legends:"+"<br>"+"")
            .style("font-size", "1vw")
            .style("fill", "#FFF");
        for (let i = 9; i < pie_data[age + " " + gender][type].length+9; i++) {
          legend.append("rect")
            .attr("x", 0)
            .attr("y", 20 + i * 30)
            .attr("width", 25)
            .attr("height", 25)
            .style("fill", color(pie_data[age + " " + gender][type][i-9].category));
          legend.append("text")
            .attr("x", 40)
            .attr("y", i * 30 + 40)
            .attr("height", 25)
            .text(pie_data[age + " " + gender][type][i-9].category)
            .style("font-size", "1vw")
            .style("fill", "#FFF");
        }
      }

      /************************ Circular Bar Graph & Line Chart ********************************/
      var width = 975;
      var height = width;
      var innerRadius = 300;
      var outerRadius = Math.min(width, height) / 2;
      var analysis = [];
      var age ="15", gender="female", major="Accounting";
    /* Request Data*/
      Promise.all([d3.json("./dataset/response.json", d3.autoType), d3.json("./dataset/major.json", d3.autoType),d3.dsv(",", "major-salaries.csv", function (d) {
      return {
        major: d.major,
        values: [+d.percentile10, +d.percentile25, +d.median, +d.percentile75, +d.percentile90]
      };
    })]).then(function (data) {
        console.log(data[2])


    /***************Line******************/
    
    var svgline = d3.select("svg#linechart")
                      .attr("viewBox", `0 0 ${width} ${height}`)
                      .style("width", "100%")
                      .style("height", "125%");

    var updateGraphLine = function (major) {
        let Salaries = data[2];
        console.log(major)
        var clear = svgline.select(".line").remove();
        var clear2 = svgline.select(".focus").remove();
        var clear3 = svgline.selectAll(".transparent").attr("opacity", 1)
        var clear4 = svgline.selectAll(".axis").attr("opacity", 1)
        var clear5 = svgline.selectAll("circle").remove();
// Set up variables
        
        let axis = svgline;
        let width = document.getElementById("linechart").clientWidth;
        let height = document.getElementById("linechart").clientHeight;
        let margin = { "top": 20, "right": 0, "bottom": 10, "left": 10 };
        let chartWidth = width - margin.left - margin.right;
        let chartHeight = height - margin.top - margin.bottom;
        console.log(chartWidth)
        var xScale = d3.scaleLinear().domain([0, 250000]).range([0, chartWidth]);
        var yScale = d3.scaleLinear().domain([0.1, 0.6]).range([chartHeight, 0]);
        var x = d3.scaleLinear().range([0, chartWidth]);
        var y = d3.scaleLinear().range([chartHeight, 0]);
        var percents = [0.1, 0.25, 0.5, 0.25, 0.1];

        // Color for Distribution Lines
        var majorArray = [];
        for (i=0;i<Salaries.length; i++) {
        majorArray.push(Salaries[i]["major"]);
        };
        var color = d3.scaleOrdinal().domain(majorArray).range(d3.schemeCategory10);

        // Y axis
        let leftAxis = d3.axisLeft(yScale).ticks(5).tickFormat(d3.format(".0%"));

        axis.append("g").attr("class", "y axis")
        .attr("opacity", 1)
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .call(leftAxis);

        // X axis
        let bottomAxis = d3.axisBottom(xScale).ticks(5).tickFormat(function (d) { return "$" + d3.format(",")(d) }); 

        let element = axis.append("g").attr("class", "x axis")
        .attr("opacity", 1)
        .attr("transform", "translate(" + margin.left + "," + (margin.top + chartHeight) + ")");

        bottomAxis(element); 

        // Axis Labels

        axis.append("text")
        .attr("class", "transparent")
        .attr("opacity", 1)
        .attr("transform",
            "translate(" + width / 2 + "," + (chartHeight + margin.top + 80) + ")")
        .style("text-anchor", "middle")
        .text("Salary")
        .style("font-size", "2vw")
        .style("fill", "#FFF");

        axis.append("text")
        .attr("class", "transparent")
        .attr("opacity", 1)
        .attr("transform", "rotate(-90)")
        .attr("y", margin.left - 80)
        .attr("x", 0 - (height / 2)-20)
        .text("Percentage")
        .style("font-size", "2vw")
        .style("fill", "#FFF");
    //Naming selected major
    var selectMajor = Salaries.filter(function (d) {
        return d.major == major;
    });

    // naming variables for graphing //
    var selectValues = selectMajor[0]["values"];
    var format = d3.format(",");

    // min- 10th percentile Variables
    var min = selectValues[0];
    var minComma = format(min);
    var minX = xScale(min);

    //25th percentile Variables
    var quarter = selectValues[1];
    var quarterComma = format(quarter);
    var quarterX = xScale(quarter);

    // median Variables
    var median = d3.median(selectValues);
    var medianComma = format(d3.median(selectValues));
    var medianX = xScale(median);

    // 75th percentile Variables
    var fourth = selectValues[3];
    var fourthComma = format(fourth);
    var fourthX = xScale(fourth);

    // 90th percentile Variables
    var max = selectValues[4];
    var maxComma = format(max);
    var maxX = xScale(max);

    // Y Scales Variables
    var tenthY = yScale(0.10);
    var quarterY = yScale(0.25);
    var medianY = yScale(0.50);

    // Putting those variables into an array for easy plotting

    var scatterArray = [["10th Percentile: ", min, minX, minComma, tenthY], ["25th Percentile: ", quarter, quarterX, quarterComma, quarterY], ["75th Percentile: ", fourth, fourthX, fourthComma, quarterY], ["90th Percentile: ", max, maxX, maxComma, tenthY]];
    var focuslineArray = [[min, minX, minComma, tenthY], [quarter, quarterX, quarterComma, quarterY], [median, medianX, medianComma, medianY], [fourth, fourthX, fourthComma, quarterY], [max, maxX, maxComma, tenthY]];
    
    // Creating Distribution Line //
    // Sources for Helping with Line Creation : 1) https://bl.ocks.org/ProQuestionAsker/8382f70af7f4a7355827c6dc4ee8817d 2) Source : http://next.plnkr.co/edit/qW77DpbScddXraajNFet?p=preview&preview

    
    var line = d3.line()
        .x(function (d, i) { return xScale(d); })
        .y(function (d, i) { return yScale(percents[i]); })
        .curve(d3.curveStepBefore)
        .curve(d3.curveCatmullRom.alpha(1));

    var g = axis.append("g").attr("class", "linedots");

    var next = g.append("path")
        .data(selectMajor)
        .attr("class", "line")
        .attr("d", function (d) {
        return line(d.values);
        })
        .style("stroke", function (d) {
        return color(d.major);
        })
        .style("stroke-width", 2)
        .attr("fill", "none")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // End of Line Creation Sources //

    // Adding Helper Lines to Line Chart //

    var focus = g.append("g")
        .attr("class", "focus");

    var focuslines = focus.selectAll("line")
        .attr("class", "hover")
        .data(focuslineArray)
        .enter()
        .append("line")
        .attr("y1", tenthY)
        .attr("y2", d => d[3])
        .attr("x1", d => d[1])
        .attr("x2", d => d[1])
        .style("stroke", "grey")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Creating Median Salary Text //

    focus.append("text")
        .attr("class", "mediantext")
        .attr("x", medianX - 15)
        .attr("y", medianY - 40)
        .text("Median Mid-Career Salary:")
        .style("font-size", "2vw")
        .style("fill", "#FFF");

    focus.append("text")
        .attr("class", "median")
        .attr("x", medianX + 28)
        .attr("y", medianY + 10)
        .text("$" + medianComma)
        .style("font-size", "2vw")
        .style("fill", "#FFF");

    focus.append("circle")
        .attr("class", "circle")
        .attr("cx", medianX)
        .attr("cy", medianY)
        .attr("r", 5)
        .attr("fill", "white")
        .attr("stroke", "black")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .on("mouseover", function () {
        d3.select(this)
            .transition().duration(100)
            .attr("r", 10);

        focus.selectAll("text")
            .transition()
            .duration(200)
            .attr("font-weight", 700);
        })
        .on("mouseout", function () {
        d3.select(this)
            .transition().duration(100)
            .attr("r", 5);

        focus.selectAll("text")
            .transition()
            .duration(200)
            .attr("font-weight", 400);
        });

    // Creating Circles and Tooltips for Percentiles //

    var scatter = g.append("g").attr("class", "dots");

    let circle = scatter.selectAll("circle")
        .data(scatterArray)
        .enter()
        .append("circle");

    circle.attr("cx", d => d[2])
        .attr("class", "circle")
        .attr("cy", d => d[4])
        .attr("r", 5)
        .attr("fill", "white")
        .attr("stroke", "black")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Source for tool tip: http://bl.ocks.org/d3noob/a22c42db65eb00d4e369 //
    var div = d3.select("div.tool").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);
    // End of tool tip source//

    circle.on("mouseover", function (d) {
        d3.select(this)
        .transition().duration(100)
        .attr("r", 10);

        // Source for tool tip: http://bl.ocks.org/d3noob/a22c42db65eb00d4e369 //
        d3.select("div.tool").selectAll("div.tooltip").remove();
        div = d3.select("div.tool").append("div")
        .attr("class", "tooltip")
        .style("opacity", 1);

        div.transition()
        .duration(200)
        .style("opacity", .9);

        div.html(d[0] + "<br/>" + "$" + d[3])
        .style("left", (d3.event.pageX) + "px")
        .style("top", (d3.event.pageY - 28) + "px");
        console.log(d[0])
        // End of tool tip source//

    });

    circle.on("mouseout", function () {
        d3.select(this)
        .transition().duration(100)
        .attr("r", 5);

        div.transition()
        .duration(500)
        .style("opacity", 0);
    });
        
    };
     updateGraphLine('Accounting');
    /***************Line END*******************/

    /*******Radius Bar Chart Update******/


    /* Reference: https://observablehq.com/@d3/radial-stacked-bar-chart */
    function updateGraph(inputkey, second_key){
          d3.select('#Chart').selectAll('g.pie').remove();
          d3.select("#legend").selectAll("rect").remove();
          d3.select("#legend").selectAll("text").remove();
          //d3.select("#Chart").selectAll("path").exit().remove();
          analysis = [];
          if(second_key == ''){
            for(let key in data[0])
            {
               if (key == inputkey){
                for (let subkey in data[0][key])
                    for (let subtitle in data[0][key][subkey])
                      analysis.push({
                        "Category": subtitle,
                        "Number": data[0][key][subkey][subtitle]
                      });
              }
            }
          }

          else{
            for(let key in data[0])
            {
               if (key == inputkey){
                for (let subkey in data[0][key])
                    for (let subtitle in data[0][key][subkey])
                      analysis.push({
                        "Category": subtitle,
                        "Number": (data[0][key][subkey][subtitle]+data[0][second_key][subkey][subtitle])/2
                      });
              }
            }
          }
        /*arc function to build arc*/
          arc = d3.arc()
                   .innerRadius(d => y(0))
                  .startAngle(d => x(d.Category))
                  .endAngle(d => x(d.Category) + x.bandwidth())
                  .padAngle(0.01)
                  .padRadius(innerRadius)
        /*angle scale*/
          x = d3.scaleBand()
                .domain(analysis.map(d => d.Category))
                .range([0, 2 * Math.PI])
                .align(0)
        /*radius scale*/
          y = function(d){
              const y = d3.scaleLinear()
                          .domain([0, 5.5])
                          .range([innerRadius * innerRadius, outerRadius * outerRadius]);
              return Math.sqrt(y(d));
          }
        /*color scale*/
          z = d3.scaleOrdinal()
                .domain(analysis.map(d => d.Category))
                .range(["#98abc5","#98abc5","#98abc5","#98abc5","#98abc5","#98abc5","#98abc5","#98abc5","#98abc5","#98abc5", "#8a89a6","#8a89a6","#8a89a6","#8a89a6","#8a89a6","#8a89a6","#8a89a6","#8a89a6","#8a89a6","#8a89a6", "#7b6888","#7b6888","#7b6888","#7b6888","#7b6888","#7b6888","#7b6888","#7b6888","#7b6888","#7b6888", "#6b486b","#6b486b","#6b486b","#6b486b","#6b486b","#6b486b","#6b486b","#6b486b","#6b486b","#6b486b", "#a05d56", "#d0743c","#d0743c","#d0743c","#d0743c","#d0743c","#d0743c","#d0743c"])

          var svg2 = d3.select("#Chart")
                      .attr("viewBox", `${-width / 2} ${-height / 2} ${width} ${height}`)
                      .style("width", "100%")
                      .style("height", "95%")
        /*build graphic*/
          seg = svg2.selectAll("path").remove();
          seg = svg2.selectAll("path")
          .data(analysis)
          .enter().append("path")
          .each(function(d) { d.outerRadius = y(0); })
          .attr("class", "bargraph")
          .attr("d", arc)
          .attr("fill", d => z(d.Category))
          .attr("note", d => d.Category)
        /*mouse events*/
          .on("mouseover", function(){
            d3.select(this).style("opacity",0.5);
          })
          .on("mouseout", function(){
            d3.select(this).style("opacity",1);
          })
          .on("click", function(){
            type = d3.select(this).attr("note");
            createPieChart(pie_data[age+" "+gender][type], type)
          })
        /*Animation for radius chart*/
          seg.transition().ease(d3.easeElastic).duration(1500).delay(function(d,i) {return (48-i)*90;})
                .attrTween("d", function(d,index) {
                  var i = d3.interpolate(d.outerRadius, y(d.Number));
                  return function(t) { d.outerRadius = i(t); return arc(d); };
                });
        /* Name of each bar*/
          xAxis = g => g
          .call(g => g.selectAll("g")
          .data(analysis)
          .enter().append("g")
          .style("fill","#FFFFFF")
          .attr("text-anchor", d =>  (((x(d.Category) + x.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) < (Math.PI/2) || ((x(d.Category) + x.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) > (Math.PI*1.5)))
                ? "end"
                : "start")) //Adjust the text direction
          .attr("dominant-baseline","central")
          .attr("transform", d => `rotate(${((x(d.Category) + x.bandwidth() / 2) * 180 / Math.PI - 90)}) translate(${innerRadius+4},0) rotate(90)`)
          .call(g => g.append("text")
          .attr("font-size","0.8vw")
          .attr("transform", d =>  (((x(d.Category) + x.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) < (Math.PI/2) || ((x(d.Category) + x.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) > (Math.PI*1.5)))
                ? "rotate(90)translate(0,0)"
                : "rotate(-90)translate(0,0)")) //Adjust the text direction
                .text(d => d.Category)))
          

          svg2.append("g")
              .call(xAxis);

          let yxis=[]
          for (let i=1;i<=5;i+=2)
                yxis.push({
                  "y": i
                });
          
          for(let key in yxis)
          {
            svg2.append("g")
              .append("circle")
              .attr("stroke", "#FFF")
              .attr("fill", "none")
              .attr("stroke-opacity", 0.3)
              .attr("r", y(yxis[key].y));
            svg2.append("text")
              .attr("y",-y(yxis[key].y))
              .attr("dy", "0.35em")
              .attr("fill", "#fff")
              .attr("font-size","1.2vw")
              .text(yxis[key].y);
          }
        
        var legend = d3.select("#legendforChart")
        let color=[];
        color.push({
          "Cate":"Spending Habits",
          "Color":"#d0743c"
        })
        color.push({
          "Cate":"Health",
          "Color":"#a05d56"
        })
        color.push({
          "Cate":"Phobias",
          "Color":"#6b486b"
        })
        color.push({
          "Cate":"Hobbies",
          "Color":"#7b6888"
        })
        color.push({
          "Cate":"Movie Preferences",
          "Color":"#8a89a6"
        })
        color.push({
          "Cate":"Music Preferences",
          "Color":"#98abc5"
        })

        let i=0;
        for (key in color) {
          legend.append("rect")
            .attr("x", 0)
            .attr("y", 20 + i * 30)
            .attr("width", 25)
            .attr("height", 25)
            .style("fill", color[key].Color);
          legend.append("text")
            .attr("x", 40)
            .attr("y", i * 30 + 40)
            .attr("height", 25)
            .text(color[key].Cate)
            .style("font-size", "1vw")
            .style("fill", "#FFF");
          i++;
        }
  
        }

    /* Dropdown functions*/
    /* Reference: https://www.w3schools.com/howto/howto_custom_select.asp */
    var x, i, j, selElmnt, a, b, c;
    /* Look for any elements with the class "age-select": */
    x = document.getElementsByClassName("custom-select");
    for (i = 0; i < x.length; i++) {
    var 
    selElmnt = x[i].getElementsByTagName("select")[0];
    /* For each element, create a new DIV that will act as the selected item: */
    a = document.createElement("DIV");
    a.setAttribute("class", "select-selected");
    a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
    x[i].appendChild(a);
    /* For each element, create a new DIV that will contain the option list: */
    b = document.createElement("DIV");
    b.setAttribute("class", "select-items select-hide");
    for (j = 1; j < selElmnt.length; j++) {
    /* For each option in the original select element,
    create a new DIV that will act as an option item: */
        c = document.createElement("DIV");
        c.innerHTML = selElmnt.options[j].innerHTML;
        c.addEventListener("click", function(e) {
            /* When an item is clicked, update the original select box,
            and the selected item: */
            var y, i, k, s, h;
            s = this.parentNode.parentNode.getElementsByTagName("select")[0];
            h = this.parentNode.previousSibling;
            for (i = 0; i < s.length; i++) {
                if (s.options[i].innerHTML == this.innerHTML) {
                    s.selectedIndex = i;
                    h.innerHTML = this.innerHTML;
                    y = this.parentNode.getElementsByClassName("same-as-selected");
                    if (h.innerHTML=="15"||h.innerHTML=="16"||h.innerHTML=="17"||h.innerHTML=="18"||h.innerHTML=="19"||h.innerHTML=="20"||h.innerHTML=="21"||h.innerHTML=="22"||h.innerHTML=="23"||h.innerHTML=="24"||h.innerHTML=="25"||h.innerHTML=="26"||h.innerHTML=="27"||h.innerHTML=="28"||h.innerHTML=="29"||h.innerHTML=="30")
                        age = h.innerHTML;
                    else if (h.innerHTML=="Male"||h.innerHTML=="Female")
                        gender = h.innerHTML;
                    else 
                        major = h.innerHTML;
                    console.log(major,h.innerHTML);
                    if (gender=="")
                    {
                      let tmpkey1 = age + " " + "female";
                      let tmpkey2 = age + " " + "male";
                      updateGraph(tmpkey1, tmpkey2);
                    }
                    else if(h.innerHTML=="15"||h.innerHTML=="16"||h.innerHTML=="17"||h.innerHTML=="18"||h.innerHTML=="19"||h.innerHTML=="20"||h.innerHTML=="21"||h.innerHTML=="22"||h.innerHTML=="23"||h.innerHTML=="24"||h.innerHTML=="25"||h.innerHTML=="26"||h.innerHTML=="27"||h.innerHTML=="28"||h.innerHTML=="29"||h.innerHTML=="30"||h.innerHTML=="Male"||h.innerHTML=="Female")
                    {
                      gender=gender.charAt(0).toLowerCase() + gender.slice(1)
                      //console.log(gender);
                      let tmpkey = age + " " + gender;
                       updateGraph(tmpkey, '');
                    }
                    else
                      updateGraphLine(major);
                  for (k = 0; k < y.length; k++) {
                    y[k].removeAttribute("class");
                  }
                this.setAttribute("class", "same-as-selected");
                break;
                }
              }
              h.click();
          });
          b.appendChild(c);
    }
    x[i].appendChild(b);
    a.addEventListener("click", function(e) {
    /* When the select box is clicked, close any other select boxes,
    and open/close the current select box: */
        e.stopPropagation();
        closeAllSelect(this);
        this.nextSibling.classList.toggle("select-hide");
        this.classList.toggle("select-arrow-active");
    });
    }

  function closeAllSelect(elmnt) {
    /* A function that will close all select boxes in the document,
    except the current select box: */
    var x, y, i, arrNo = [];
    x = document.getElementsByClassName("select-items");
    y = document.getElementsByClassName("select-selected");
    for (i = 0; i < y.length; i++) {
      if (elmnt == y[i]) {
        arrNo.push(i)
      } 
      else {
      y[i].classList.remove("select-arrow-active");
      }
      }
    for (i = 0; i < x.length; i++) {
      if (arrNo.indexOf(i)) {
        x[i].classList.add("select-hide");
      }
    }
  }

/* If the user clicks anywhere outside the select box,
then close all select boxes: */
  document.addEventListener("click", closeAllSelect);
/* Default Playing*/  
  let tmpkey1 = age + " " + "female";
  let tmpkey2 = age + " " + "male";
  updateGraph(tmpkey1, tmpkey2);
  });
}
requestData();
</script>
</body>
</html>